{% extends 'base.html' %}
{% block title %}Settings - LexiBots{% endblock %}

{% block extra_css %}
<style>
    /* Custom scrollbar for dark theme */
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }

    /* Enhanced tech background with moving grid */
    .tech-bg {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
    }
    
    .tech-bg::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 200%;
        background-image: 
            linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
        background-size: 30px 30px;
        z-index: 1;
        animation: tech-grid-move 30s linear infinite;
    }
    
    @keyframes tech-grid-move {
        0% { transform: translate(0, 0); }
        100% { transform: translate(30px, 30px); }
    }

    /* Holographic text effect */
    .holo-text {
        background: linear-gradient(45deg, 
            #00ffff 0%, 
            #3b82f6 25%, 
            #00ffff 50%, 
            #3b82f6 75%, 
            #00ffff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: holo-shimmer 3s ease-in-out infinite;
    }
    
    @keyframes holo-shimmer {
        0%, 100% { filter: hue-rotate(0deg); }
        50% { filter: hue-rotate(180deg); }
    }

    /* Floating particles background */
    .particles-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
    }
    
    .particle {
        position: absolute;
        background: rgba(0, 255, 255, 0.6);
        border-radius: 50%;
        animation: float-particle linear infinite;
    }
    
    @keyframes float-particle {
        0% {
            transform: translateY(100vh) scale(0);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(-100px) scale(1);
            opacity: 0;
        }
    }

    /* Hexagonal container effect */
    .hex-container {
        position: relative;
        background: linear-gradient(135deg, 
            rgba(0, 255, 255, 0.1) 0%, 
            transparent 50%, 
            rgba(0, 255, 255, 0.1) 100%);
        border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    .hex-container::before {
        content: '';
        position: absolute;
        top: -1px;
        left: -1px;
        right: -1px;
        bottom: -1px;
        background: linear-gradient(45deg, 
            rgba(0, 255, 255, 0.2), 
            transparent, 
            rgba(0, 255, 255, 0.2));
        z-index: -1;
        border-radius: inherit;
    }

    /* Pulsing glow animation */
    .pulse-glow {
        animation: pulse-glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes pulse-glow {
        from {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        to {
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.6);
        }
    }

    /* Floating action icons */
    .floating-icon {
        position: relative;
        transition: all 0.3s ease;
    }
    
    .floating-icon:hover {
        transform: translateY(-2px);
        filter: drop-shadow(0 4px 8px rgba(0, 255, 255, 0.4));
    }

    /* Toggle switches */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #374151;
        transition: .4s;
        border-radius: 34px;
        border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #3b82f6;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    /* Form styling */
    .form-group {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        color: #d1d5db;
        font-weight: 500;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 0.5rem;
        color: white;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: rgba(0, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    }

    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
    }

    /* Notification styles */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.success {
        background: linear-gradient(135deg, #059669, #10b981);
    }
    
    .notification.error {
        background: linear-gradient(135deg, #dc2626, #ef4444);
    }
    
    .notification.info {
        background: linear-gradient(135deg, #0369a1, #3b82f6);
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen tech-bg">
    <!-- Floating Particles Background -->
    <div class="particles-bg" id="particles-container"></div>

    <div class="container mx-auto px-6 py-8 relative z-10">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-4">
                <a href="{% url 'bot_chat' %}" class="p-2 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-cyber-cyan floating-icon">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <div>
                    <h1 class="text-3xl font-heading font-bold text-white">User <span class="holo-text">Settings</span></h1>
                    <p class="text-gray-400">Customize your LexiBots experience</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Settings Navigation -->
            <div class="lg:col-span-1">
                <div class="hex-container rounded-lg p-6">
                    <h2 class="text-xl font-heading font-bold text-white mb-6">Settings <span class="holo-text">Menu</span></h2>
                    <nav class="space-y-2">
                        <a href="#profile" onclick="showSection('profile')" 
                           class="settings-nav-item flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors floating-icon active">
                            <svg class="w-5 h-5 text-accent-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <span class="text-white">Profile</span>
                        </a>
                        <a href="#preferences" onclick="showSection('preferences')" 
                           class="settings-nav-item flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors floating-icon">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                            </svg>
                            <span class="text-gray-300">Preferences</span>
                        </a>
                        <a href="#notifications" onclick="showSection('notifications')" 
                           class="settings-nav-item flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors floating-icon">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM6 2v6H4a2 2 0 00-2 2v8a2 2 0 002 2h16a2 2 0 002-2V10a2 2 0 00-2-2h-2V2H6z"/>
                            </svg>
                            <span class="text-gray-300">Notifications</span>
                        </a>
                        <a href="#privacy" onclick="showSection('privacy')" 
                           class="settings-nav-item flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors floating-icon">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            <span class="text-gray-300">Privacy & Security</span>
                        </a>
                        <a href="#about" onclick="showSection('about')" 
                           class="settings-nav-item flex items-center space-x-3 w-full text-left p-3 rounded-lg hover:bg-gray-700/50 transition-colors floating-icon">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span class="text-gray-300">About</span>
                        </a>
                    </nav>
                </div>

                <!-- Quick Actions -->
                <div class="hex-container rounded-lg p-6 mt-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button onclick="exportData()" 
                                class="w-full bg-gray-700/50 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors floating-icon flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Export Data
                        </button>
                        <button onclick="clearCache()" 
                                class="w-full bg-gray-700/50 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors floating-icon flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Clear Cache
                        </button>
                        <button onclick="confirmLogout()" 
                                class="w-full bg-red-600/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-600/40 transition-colors floating-icon flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Content -->
            <div class="lg:col-span-2">
                <!-- Profile Section -->
                <div id="profile-section" class="settings-section">
                    <div class="hex-container rounded-lg p-6">
                        <h2 class="text-xl font-heading font-bold text-white mb-6">Profile <span class="holo-text">Information</span></h2>
                        
                        <form method="post" class="space-y-6" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            
                            <!-- User Avatar -->
                            <div class="flex items-center space-x-6">
                                <div class="w-20 h-20 bg-accent-blue/20 rounded-full flex items-center justify-center pulse-glow">
                                    <svg class="w-10 h-10 text-accent-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-white">{{ user.get_full_name|default:user.username }}</h3>
                                    <p class="text-gray-400">{{ user.email }}</p>
                                    <p class="text-sm text-gray-500">Member since {{ user.date_joined|date:"M Y" }}</p>
                                </div>
                            </div>

                            <!-- Profile Fields -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="form-group">
                                    <label class="form-label">First Name</label>
                                    <input type="text" name="first_name" value="{{ user.first_name }}" 
                                           class="form-input" placeholder="Enter first name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" name="last_name" value="{{ user.last_name }}" 
                                           class="form-input" placeholder="Enter last name">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" name="email" value="{{ user.email }}" 
                                       class="form-input" placeholder="Enter email address">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Username</label>
                                <input type="text" name="username" value="{{ user.username }}" 
                                       class="form-input" placeholder="Enter username" readonly>
                                <p class="text-xs text-gray-500 mt-1">Username cannot be changed</p>
                            </div>

                            <button type="submit" 
                                    class="bg-accent-blue text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors pulse-glow floating-icon">
                                Update Profile
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div id="preferences-section" class="settings-section hidden">
                    <div class="hex-container rounded-lg p-6">
                        <h2 class="text-xl font-heading font-bold text-white mb-6">User <span class="holo-text">Preferences</span></h2>
                        
                        <form method="post" class="space-y-6" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="form-group">
                                    <label class="form-label">Preferred Language</label>
                                    <select name="preferred_language" class="form-input form-select">
                                        <option value="en" {% if form.preferred_language.value == 'en' %}selected{% endif %}>English</option>
                                        <option value="hi" {% if form.preferred_language.value == 'hi' %}selected{% endif %}>Hindi</option>
                                        <option value="mr" {% if form.preferred_language.value == 'mr' %}selected{% endif %}>Marathi</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Timezone</label>
                                    <input type="text" name="timezone" value="{{ form.timezone.value|default:'UTC' }}" 
                                           class="form-input" placeholder="Enter timezone">
                                </div>
                            </div>

                            <!-- AI Preferences -->
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-white">AI Assistant Preferences</h3>
                                
                                <div class="flex items-center justify-between py-3 border-b border-gray-700">
                                    <div>
                                        <p class="text-white">Detailed Explanations</p>
                                        <p class="text-sm text-gray-400">Get comprehensive legal explanations</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="detailed_explanations" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between py-3 border-b border-gray-700">
                                    <div>
                                        <p class="text-white">Voice Responses</p>
                                        <p class="text-sm text-gray-400">Enable text-to-speech for AI responses</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="voice_responses">
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between py-3 border-b border-gray-700">
                                    <div>
                                        <p class="text-white">Auto-save Conversations</p>
                                        <p class="text-sm text-gray-400">Automatically save chat sessions</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="auto_save_chats" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <button type="submit" 
                                    class="bg-accent-blue text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors pulse-glow floating-icon">
                                Save Preferences
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div id="notifications-section" class="settings-section hidden">
                    <div class="hex-container rounded-lg p-6">
                        <h2 class="text-xl font-heading font-bold text-white mb-6">Notification <span class="holo-text">Settings</span></h2>
                        
                        <form method="post" class="space-y-4" action="{% url 'user_settings' %}">
                            {% csrf_token %}
                            
                            <div class="flex items-center justify-between py-4 border-b border-gray-700">
                                <div>
                                    <p class="text-white">Email Notifications</p>
                                    <p class="text-sm text-gray-400">Receive updates via email</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="notifications_enabled" 
                                           {% if form.notifications_enabled.value %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between py-4 border-b border-gray-700">
                                <div>
                                    <p class="text-white">Document Processing</p>
                                    <p class="text-sm text-gray-400">Notify when document analysis is complete</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="document_notifications" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between py-4 border-b border-gray-700">
                                <div>
                                    <p class="text-white">System Updates</p>
                                    <p class="text-sm text-gray-400">Get notified about new features</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="system_updates">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between py-4">
                                <div>
                                    <p class="text-white">Security Alerts</p>
                                    <p class="text-sm text-gray-400">Important security notifications</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="security_alerts" checked disabled>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <button type="submit" 
                                    class="bg-accent-blue text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors pulse-glow floating-icon">
                                Save Notifications
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Privacy Section -->
                <div id="privacy-section" class="settings-section hidden">
                    <div class="hex-container rounded-lg p-6">
                        <h2 class="text-xl font-heading font-bold text-white mb-6">Privacy & <span class="holo-text">Security</span></h2>
                        
                        <div class="space-y-6">
                            <!-- Password Change -->
                            <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                                <h3 class="text-lg font-semibold text-white mb-4">Change Password</h3>
                                <form method="post" action="{% url 'user_settings' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="change_password">
                                    <div class="grid grid-cols-1 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">Current Password</label>
                                            <input type="password" name="current_password" class="form-input" placeholder="Enter current password" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">New Password</label>
                                            <input type="password" name="new_password1" class="form-input" placeholder="Enter new password" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Confirm New Password</label>
                                            <input type="password" name="new_password2" class="form-input" placeholder="Confirm new password" required>
                                        </div>
                                        <button type="submit" 
                                                class="bg-accent-blue text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors floating-icon">
                                            Update Password
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Data & Privacy -->
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-white">Data & Privacy Controls</h3>
                                
                                <div class="flex items-center justify-between py-3 border-b border-gray-700">
                                    <div>
                                        <p class="text-white">Data Collection</p>
                                        <p class="text-sm text-gray-400">Allow usage analytics for service improvement</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="data_collection" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between py-3 border-b border-gray-700">
                                    <div>
                                        <p class="text-white">Document Retention</p>
                                        <p class="text-sm text-gray-400">Keep documents after analysis (recommended)</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="document_retention" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Account Statistics -->
                            <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-700">
                                <h3 class="text-lg font-semibold text-white mb-4">Account Statistics</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-2xl font-bold text-white">{{ user.documents.count|default:0 }}</p>
                                        <p class="text-sm text-gray-400">Documents Uploaded</p>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-white">{{ user.chat_sessions.count|default:0 }}</p>
                                        <p class="text-sm text-gray-400">Chat Sessions</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Danger Zone -->
                            <div class="bg-red-900/20 border border-red-500/30 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold text-red-400 mb-4">Danger Zone</h3>
                                <div class="space-y-3">
                                    <button onclick="deleteAllData()" 
                                            class="bg-red-600/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-600/40 transition-colors floating-icon">
                                        Delete All My Data
                                    </button>
                                    <button onclick="deleteAccount()" 
                                            class="bg-red-600/20 text-red-400 px-4 py-2 rounded-lg hover:bg-red-600/40 transition-colors floating-icon">
                                        Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div id="about-section" class="settings-section hidden">
                    <div class="hex-container rounded-lg p-6">
                        <h2 class="text-xl font-heading font-bold text-white mb-6">About <span class="holo-text">LexiBots</span></h2>
                        
                        <div class="space-y-6">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-accent-blue rounded-lg flex items-center justify-center mx-auto mb-4 pulse-glow">
                                    <img src="https://i.imgur.com/g3c5jA5.png" alt="LexiBots" class="w-12 h-12 object-contain">
                                </div>
                                <h3 class="text-2xl font-bold text-white mb-2">LexiBots AI Legal Assistant</h3>
                                <p class="text-gray-400">Version 1.0.0</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-900/50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-white mb-2">Features</h4>
                                    <ul class="text-sm text-gray-300 space-y-1">
                                        <li>• Document Analysis</li>
                                        <li>• AI Legal Assistance</li>
                                        <li>• Multi-format Support</li>
                                        <li>• Voice Interactions</li>
                                        <li>• Secure Processing</li>
                                        <li>• Multi-language Support</li>
                                        <li>• Chat History</li>
                                        <li>• Real-time Processing</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-900/50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-white mb-2">Support</h4>
                                    <div class="text-sm text-gray-300 space-y-2">
                                        <p><strong>Email:</strong> support@lexibots.com</p>
                                        <p><strong>Documentation:</strong> docs.lexibots.com</p>
                                        <p><strong>Status:</strong> status.lexibots.com</p>
                                        <p><strong>GitHub:</strong> github.com/lexibots</p>
                                    </div>
                                </div>
                            </div>

                            <!-- System Information -->
                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h4 class="font-semibold text-white mb-3">System Information</h4>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-400">Django Version</p>
                                        <p class="text-white">4.2.7</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Python Version</p>
                                        <p class="text-white">3.11+</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Database</p>
                                        <p class="text-white">SQLite</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Last Update</p>
                                        <p class="text-white">{{ user.last_login|date:"M d, Y" }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Legal Information -->
                            <div class="text-center text-sm text-gray-400">
                                <p>&copy; 2024 LexiBots. All rights reserved.</p>
                                <div class="flex justify-center space-x-4 mt-2">
                                    <a href="#" class="hover:text-accent-blue">Privacy Policy</a>
                                    <a href="#" class="hover:text-accent-blue">Terms of Service</a>
                                    <a href="#" class="hover:text-accent-blue">License</a>
                                    <a href="{% url 'contact' %}" class="hover:text-accent-blue">Contact</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // CSRF Token for Django
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    // Particle system
    function createParticle() {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 3 + 1;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDuration = (Math.random() * 10 + 5) + 's';
        particle.style.animationDelay = Math.random() * 2 + 's';
        
        document.getElementById('particles-container').appendChild(particle);
        
        setTimeout(() => {
            particle.remove();
        }, 15000);
    }
    
    setInterval(createParticle, 300);
    for (let i = 0; i < 20; i++) {
        setTimeout(() => createParticle(), i * 100);
    }

    // Show settings section
    function showSection(sectionName) {
        // Hide all sections
        document.querySelectorAll('.settings-section').forEach(section => {
            section.classList.add('hidden');
        });
        
        // Show selected section
        document.getElementById(sectionName + '-section').classList.remove('hidden');
        
        // Update navigation
        document.querySelectorAll('.settings-nav-item').forEach(item => {
            item.classList.remove('active');
            const svg = item.querySelector('svg');
            const span = item.querySelector('span');
            svg.classList.remove('text-accent-blue');
            svg.classList.add('text-gray-400');
            span.classList.remove('text-white');
            span.classList.add('text-gray-300');
        });
        
        const activeItem = document.querySelector(`[href="#${sectionName}"]`);
        if (activeItem) {
            activeItem.classList.add('active');
            const activeSvg = activeItem.querySelector('svg');
            const activeSpan = activeItem.querySelector('span');
            activeSvg.classList.remove('text-gray-400');
            activeSvg.classList.add('text-accent-blue');
            activeSpan.classList.remove('text-gray-300');
            activeSpan.classList.add('text-white');
        }
    }

    // Quick actions
    function exportData() {
        showNotification('Preparing data export...', 'info');
        
        // Create a data export
        const exportData = {
            profile: {
                username: '{{ user.username }}',
                email: '{{ user.email }}',
                full_name: '{{ user.get_full_name }}',
                date_joined: '{{ user.date_joined|date:"c" }}'
            },
            statistics: {
                documents: '{{ user.documents.count|default:0 }}',
                chat_sessions: '{{ user.chat_sessions.count|default:0 }}'
            },
            exported_at: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'lexibots_data_export.json';
        a.click();
        URL.revokeObjectURL(url);
        
        showNotification('Data exported successfully!', 'success');
    }

    function clearCache() {
        if (confirm('Clear application cache? This may improve performance but will require re-downloading some resources.')) {
            // Clear various caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // Clear localStorage if available
            try {
                localStorage.clear();
            } catch (e) {
                // Handle cases where localStorage is not available
            }
            
            showNotification('Cache cleared successfully', 'success');
        }
    }

    function confirmLogout() {
        if (confirm('Are you sure you want to logout? Any unsaved changes will be lost.')) {
            window.location.href = '{% url "logout" %}';
        }
    }

    function deleteAllData() {
        if (confirm('⚠️ WARNING: This will permanently delete all your documents, chat history, and associated data. This action cannot be undone.')) {
            if (confirm('Are you absolutely certain? Type "DELETE" in the prompt to confirm.')) {
                const confirmation = prompt('Type "DELETE" to confirm data deletion:');
                if (confirmation === 'DELETE') {
                    showNotification('Data deletion initiated...', 'error');
                    
                    fetch('/api/delete-user-data/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken
                        },
                        body: JSON.stringify({ action: 'delete_all_data' })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('All data deleted successfully', 'success');
                            setTimeout(() => window.location.reload(), 2000);
                        } else {
                            showNotification('Data deletion failed', 'error');
                        }
                    })
                    .catch(() => {
                        showNotification('Data deletion failed', 'error');
                    });
                } else {
                    showNotification('Data deletion cancelled', 'info');
                }
            }
        }
    }

    function deleteAccount() {
        if (confirm('⚠️ FINAL WARNING: This will permanently delete your entire account and all associated data. This action cannot be undone and you will lose access forever.')) {
            if (confirm('Are you absolutely sure? This will delete your account permanently.')) {
                const confirmation = prompt('Type your username to confirm account deletion:');
                if (confirmation === '{{ user.username }}') {
                    showNotification('Account deletion initiated...', 'error');
                    
                    fetch('/api/delete-account/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken
                        },
                        body: JSON.stringify({ action: 'delete_account' })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Account deleted successfully', 'success');
                            setTimeout(() => window.location.href = '/', 3000);
                        } else {
                            showNotification('Account deletion failed', 'error');
                        }
                    })
                    .catch(() => {
                        showNotification('Account deletion failed', 'error');
                    });
                } else {
                    showNotification('Account deletion cancelled - username mismatch', 'info');
                }
            }
        }
    }

    // Notification system
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.classList.add('show'), 100);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Enhanced hover effects
    document.querySelectorAll('.floating-icon').forEach(icon => {
        icon.addEventListener('mouseenter', () => {
            icon.style.filter = 'drop-shadow(0 4px 12px rgba(0, 255, 255, 0.6))';
        });
        icon.addEventListener('mouseleave', () => {
            icon.style.filter = 'none';
        });
    });

    // Form submission handlers
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<svg class="w-4 h-4 animate-spin inline mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Saving...';
                
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = submitBtn.innerHTML.replace('<svg class="w-4 h-4 animate-spin inline mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Saving...', submitBtn.textContent);
                }, 2000);
            }
        });
    });

    // Initialize first section
    document.addEventListener('DOMContentLoaded', function() {
        showSection('profile');
    });

    // Auto-save toggle states
    document.querySelectorAll('.toggle-switch input').forEach(toggle => {
        toggle.addEventListener('change', function() {
            const setting = this.name;
            const value = this.checked;
            
            // Auto-save toggle states (optional)
            fetch('/api/update-preference/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ 
                    setting: setting, 
                    value: value 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`${setting.replace('_', ' ')} ${value ? 'enabled' : 'disabled'}`, 'success');
                }
            })
            .catch(() => {
                // Revert toggle if save failed
                this.checked = !value;
                showNotification('Failed to save preference', 'error');
            });
        });
    });
</script>
{% endblock %}